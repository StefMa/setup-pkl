amends "package://pkg.pkl-lang.org/github.com/stefma/pkl-gha/com.github.action@0.0.3#/GitHubAction.pkl"

name = "Lint Codebase"

on {
  pull_request {}
  push {
    branches {
      "main"
    }
  }
}

permissions {
  contents = "read"
  packages = "read"
  statuses = "write"
}

jobs {
  ["test-typescript"] {
    name = "Lint Codebase"
    `runs-on` = "ubuntu-latest"
    steps {
      new {
        name = "Checkout"
        uses = "actions/checkout@v4"
        with {
          ["fetch-depth"] = 0
        }
      }
      new {
        name = "Setup Node.js"
        uses = "actions/setup-node@v4"
        with {
          ["node-version-file"] = ".nvmrc"
          ["cache"] = "npm"
        }
      }
      new {
        name = "Install Dependencies"
        run = "npm ci"
      }
      new {
        name = "Lint Codebase"
        uses = "super-linter/super-linter/slim@v6"
        env {
          ["DEFAULT_BRANCH"] = "main"
          ["FILTER_REGEX_EXCLUDE"] = "dist/**/*"
          ["GITHUB_TOKEN"] = "${{ secrets.GITHUB_TOKEN }}"
          ["VALIDATE_ALL_CODEBASE"] = "true"
          ["VALIDATE_JAVASCRIPT_STANDARD"] = "false"
          ["VALIDATE_JSCPD"] = "false"
          ["VALIDATE_TYPESCRIPT_STANDARD"] = "false"
        }
      }
    }
  }
}